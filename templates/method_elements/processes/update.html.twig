{% extends 'base.html.twig' %}

{% block title %} Update Process {% endblock %}

{% block body %}

    {# Warning messages #}
    <div class="mt-4">
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ label }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endfor %}
    </div>

    {# Form box #}
    <div class="card mt-4">
        <div class="card-header bg-success">
            <b>Update Process</b>
        </div>
        <div class="card-body">
            {{ form_errors(form) }}
            {{ form_start(form) }}
            {{ form_row(form.name) }}
            {{ form_row(form.parentProcessKind) }}
            <div class="d-flex flex-column">
                <h5> In which other process types can it be used?</h5>
                <div style="max-height: 250px; overflow: auto">
                    {{ form_row(form.otherRelatedProcessKinds) }}
                </div>

            </div>

            <button type="submit" class="btn btn-primary mt-3">Save</button>
            {{ form_end(form) }}

        </div>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $(document).ready(function () {
            $("legend").remove();
            let parentAndChildProcessTypes = JSON.parse(("{{ childAndParentProcessTypes|json_encode  }}").
            replace(/&quot;/ig,'"'));
            console.log(parentAndChildProcessTypes);

            let parentProcessKind = $("#process_parentProcessKind");
            disableParentProcessTypesInRelatedTypes();

            parentProcessKind.on("change", function () {
                $('input[type=checkbox]').each(function (){
                    $(this).parent().css("display","block");
                });
                disableParentProcessTypesInRelatedTypes();
            });

            function disableParentProcessTypesInRelatedTypes() {
                let childProcessType = parentProcessKind.find(":selected").text();
                let parentProcessType = parentAndChildProcessTypes[childProcessType];

                $('input[type=checkbox]').each(function () {
                    if (childProcessType === $(this).next('label').text())
                    {
                        if($(this).is(":checked"))
                            $(this).prop('checked', false);
                        $(this).parent().css("display", "none");
                    }
                    if (parentProcessType === $(this).next('label').text())
                    {
                        if($(this).is(":checked"))
                            $(this).prop('checked', false);
                        $(this).parent().css("display", "none");
                    }
                });
            }
        });


    </script>
{% endblock %}